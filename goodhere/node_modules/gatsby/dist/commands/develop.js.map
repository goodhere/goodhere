{"version":3,"sources":["../../src/commands/develop.ts"],"names":["REGEX_IP","setTimeout","telemetry","trackCli","startServer","program","indexHTMLActivity","report","phantomActivity","start","directory","directoryPath","workerPool","WorkerPool","create","createIndexHtml","activity","stage","BuildHTMLStage","DevelopHTML","pagePaths","err","name","panic","stripIndent","end","webpackActivity","activityTimer","id","devConfig","port","parentSpan","span","compiler","app","use","expressMiddleware","log","path","heartbeat","graphqlEndpoint","process","env","GATSBY_GRAPHQL_IDE","get","endpoint","schema","schemaCustomization","store","getState","graphiql","context","schemaComposer","composer","customContext","customFormatErrorFn","stack","split","REFRESH_ENDPOINT","refresh","req","webhookBody","body","express","json","post","res","enableRefresh","ENABLE_GATSBY_REFRESH_ENDPOINT","refreshToken","GATSBY_REFRESH_TOKEN","authorizedRefresh","headers","authorization","query","fileName","lineNumber","index","logLevel","publicPath","output","watchOptions","devServer","stats","developMiddleware","config","proxy","forEach","prefix","url","proxiedUrl","originalUrl","host","method","pipe","got","stream","decompress","on","response","writeHead","statusCode","_","message","error","sendStatus","status","sendFile","server","ssl","https","createServer","http","Server","socket","websocketManager","init","listener","listen","watchGlobs","map","chokidar","watch","to","emit","module","exports","exit","GATSBY_EXPERIMENTAL_PAGE_BUILD_ON_DATA_CHANGES","chalk","yellow","cyan","openTracingConfigFile","pendingActivity","startBackgroundUpdate","parseInt","e","sslHost","test","certFile","keyFile","graphqlRunner","queryUtil","initialProcessQueries","require","boundActionCreators","setProgramStatus","db","saveState","requiresWriter","startListener","startAutosave","startListeningToDevelopQueue","queryWatcher","startWatchDeletePage","prepareUrls","protocol","formatUrl","hostname","format","pathname","prettyPrintUrl","bold","String","isUnspecifiedHost","prettyHost","lanUrlForConfig","lanUrlForTerminal","address","ip","undefined","_e","localUrlForTerminal","localUrlForBrowser","printInstructions","appName","urls","console","printDeprecationWarnings","deprecatedApis","fixMap","newName","docsLink","pathContext","deprecatedLocations","glob","sync","nodir","file","fileText","fs","readFileSync","matchingApis","filter","api","includes","push","length","hooks","watchRun","tapAsync","done","isFirstCompile","messages","toJson","isSuccessful","errors","sitePackageJson","open","Promise","resolve","catch","compilation","panicOnBuild"],"mappings":"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","sourcesContent":["import url from \"url\"\nimport fs from \"fs\"\nimport openurl from \"better-opn\"\nimport chokidar from \"chokidar\"\n\nimport webpackHotMiddleware from \"webpack-hot-middleware\"\nimport webpackDevMiddleware from \"webpack-dev-middleware\"\nimport glob from \"glob\"\nimport express from \"express\"\nimport got from \"got\"\nimport webpack from \"webpack\"\nimport graphqlHTTP from \"express-graphql\"\nimport graphqlPlayground from \"graphql-playground-middleware-express\"\nimport graphiqlExplorer from \"gatsby-graphiql-explorer\"\nimport { formatError } from \"graphql\"\n\nimport webpackConfig from \"../utils/webpack.config\"\nimport bootstrap from \"../bootstrap\"\nimport { store } from \"../redux\"\nimport { syncStaticDir } from \"../utils/get-static-dir\"\nimport { buildHTML } from \"./build-html\"\nimport { withBasePath } from \"../utils/path\"\nimport report from \"gatsby-cli/lib/reporter\"\nimport launchEditor from \"react-dev-utils/launchEditor\"\nimport formatWebpackMessages from \"react-dev-utils/formatWebpackMessages\"\nimport chalk from \"chalk\"\nimport address from \"address\"\nimport cors from \"cors\"\nimport telemetry from \"gatsby-telemetry\"\nimport * as WorkerPool from \"../utils/worker/pool\"\nimport http from \"http\"\nimport https from \"https\"\n\nimport { bootstrapSchemaHotReloader } from \"../bootstrap/schema-hot-reloader\"\nimport bootstrapPageHotReloader from \"../bootstrap/page-hot-reloader\"\nimport { developStatic } from \"./develop-static\"\nimport withResolverContext from \"../schema/context\"\nimport sourceNodes from \"../utils/source-nodes\"\nimport { createSchemaCustomization } from \"../utils/create-schema-customization\"\nimport { websocketManager } from \"../utils/websocket-manager\"\nimport getSslCert from \"../utils/get-ssl-cert\"\nimport { slash } from \"gatsby-core-utils\"\nimport { initTracer } from \"../utils/tracer\"\nimport apiRunnerNode from \"../utils/api-runner-node\"\nimport db from \"../db\"\nimport { detectPortInUseAndPrompt } from \"../utils/detect-port-in-use-and-prompt\"\nimport onExit from \"signal-exit\"\nimport queryUtil from \"../query\"\nimport queryWatcher from \"../query/query-watcher\"\nimport requiresWriter from \"../bootstrap/requires-writer\"\nimport {\n  reportWebpackWarnings,\n  structureWebpackErrors,\n} from \"../utils/webpack-error-utils\"\nimport { waitUntilAllJobsComplete } from \"../utils/wait-until-jobs-complete\"\nimport {\n  userPassesFeedbackRequestHeuristic,\n  showFeedbackRequest,\n} from \"../utils/feedback\"\n\nimport { BuildHTMLStage, IProgram } from \"./types\"\n\n// checks if a string is a valid ip\nconst REGEX_IP = /^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])$/\n\n// const isInteractive = process.stdout.isTTY\n\n// Watch the static directory and copy files to public as they're added or\n// changed. Wait 10 seconds so copying doesn't interfere with the regular\n// bootstrap.\nsetTimeout(() => {\n  syncStaticDir()\n}, 10000)\n\nonExit(() => {\n  telemetry.trackCli(`DEVELOP_STOP`)\n})\n\ntype ActivityTracker = any // TODO: Replace this with proper type once reporter is typed\n\ninterface IServer {\n  compiler: webpack.Compiler\n  listener: http.Server | https.Server\n  webpackActivity: ActivityTracker\n}\n\nasync function startServer(program: IProgram): Promise<IServer> {\n  const indexHTMLActivity = report.phantomActivity(`building index.html`, {})\n  indexHTMLActivity.start()\n  const directory = program.directory\n  const directoryPath = withBasePath(directory)\n  const workerPool = WorkerPool.create()\n  const createIndexHtml = async (activity: ActivityTracker): Promise<void> => {\n    try {\n      await buildHTML({\n        program,\n        stage: BuildHTMLStage.DevelopHTML,\n        pagePaths: [`/`],\n        workerPool,\n        activity,\n      })\n    } catch (err) {\n      if (err.name !== `WebpackError`) {\n        report.panic(err)\n        return\n      }\n      report.panic(\n        report.stripIndent`\n          There was an error compiling the html.js component for the development server.\n\n          See our docs page on debugging HTML builds for help https://gatsby.dev/debug-html\n        `,\n        err\n      )\n    }\n  }\n\n  await createIndexHtml(indexHTMLActivity)\n\n  indexHTMLActivity.end()\n\n  // report.stateUpdate(`webpack`, `IN_PROGRESS`)\n\n  const webpackActivity = report.activityTimer(`Building development bundle`, {\n    id: `webpack-develop`,\n  })\n  webpackActivity.start()\n\n  const devConfig = await webpackConfig(\n    program,\n    directory,\n    `develop`,\n    program.port,\n    { parentSpan: webpackActivity.span }\n  )\n\n  const compiler = webpack(devConfig)\n\n  /**\n   * Set up the express app.\n   **/\n  const app = express()\n  app.use(telemetry.expressMiddleware(`DEVELOP`))\n  app.use(\n    webpackHotMiddleware(compiler, {\n      log: false,\n      path: `/__webpack_hmr`,\n      heartbeat: 10 * 1000,\n    })\n  )\n\n  app.use(cors())\n\n  /**\n   * Pattern matching all endpoints with graphql or graphiql with 1 or more leading underscores\n   */\n  const graphqlEndpoint = `/_+graphi?ql`\n\n  if (process.env.GATSBY_GRAPHQL_IDE === `playground`) {\n    app.get(\n      graphqlEndpoint,\n      graphqlPlayground({\n        endpoint: `/___graphql`,\n      }),\n      () => {}\n    )\n  } else {\n    graphiqlExplorer(app, {\n      graphqlEndpoint,\n    })\n  }\n\n  app.use(\n    graphqlEndpoint,\n    graphqlHTTP(\n      (): graphqlHTTP.OptionsData => {\n        const { schema, schemaCustomization } = store.getState()\n\n        return {\n          schema,\n          graphiql: false,\n          context: withResolverContext({\n            schema,\n            schemaComposer: schemaCustomization.composer,\n            context: {},\n            customContext: schemaCustomization.context,\n          }),\n          customFormatErrorFn(err): unknown {\n            return {\n              ...formatError(err),\n              stack: err.stack ? err.stack.split(`\\n`) : [],\n            }\n          },\n        }\n      }\n    )\n  )\n\n  /**\n   * Refresh external data sources.\n   * This behavior is disabled by default, but the ENABLE_GATSBY_REFRESH_ENDPOINT env var enables it\n   * If no GATSBY_REFRESH_TOKEN env var is available, then no Authorization header is required\n   **/\n  const REFRESH_ENDPOINT = `/__refresh`\n  const refresh = async (req: express.Request): Promise<void> => {\n    let activity = report.activityTimer(`createSchemaCustomization`, {})\n    activity.start()\n    await createSchemaCustomization({\n      refresh: true,\n    })\n    activity.end()\n    activity = report.activityTimer(`Refreshing source data`, {})\n    activity.start()\n    await sourceNodes({\n      webhookBody: req.body,\n    })\n    activity.end()\n  }\n  app.use(REFRESH_ENDPOINT, express.json())\n  app.post(REFRESH_ENDPOINT, (req, res) => {\n    const enableRefresh = process.env.ENABLE_GATSBY_REFRESH_ENDPOINT\n    const refreshToken = process.env.GATSBY_REFRESH_TOKEN\n    const authorizedRefresh =\n      !refreshToken || req.headers.authorization === refreshToken\n\n    if (enableRefresh && authorizedRefresh) {\n      refresh(req)\n    }\n    res.end()\n  })\n\n  app.get(`/__open-stack-frame-in-editor`, (req, res) => {\n    launchEditor(req.query.fileName, req.query.lineNumber)\n    res.end()\n  })\n\n  // Disable directory indexing i.e. serving index.html from a directory.\n  // This can lead to serving stale html files during development.\n  //\n  // We serve by default an empty index.html that sets up the dev environment.\n  app.use(developStatic(`public`, { index: false }))\n\n  app.use(\n    webpackDevMiddleware(compiler, {\n      logLevel: `silent`,\n      publicPath: devConfig.output.publicPath,\n      watchOptions: devConfig.devServer\n        ? devConfig.devServer.watchOptions\n        : null,\n      stats: `errors-only`,\n    })\n  )\n\n  // Expose access to app for advanced use cases\n  const { developMiddleware } = store.getState().config\n\n  if (developMiddleware) {\n    developMiddleware(app, program)\n  }\n\n  // Set up API proxy.\n  const { proxy } = store.getState().config\n  if (proxy) {\n    proxy.forEach(({ prefix, url }) => {\n      app.use(`${prefix}/*`, (req, res) => {\n        const proxiedUrl = url + req.originalUrl\n        const {\n          // remove `host` from copied headers\n          // eslint-disable-next-line @typescript-eslint/no-unused-vars\n          headers: { host, ...headers },\n          method,\n        } = req\n        req\n          .pipe(\n            got\n              .stream(proxiedUrl, { headers, method, decompress: false })\n              .on(`response`, response =>\n                res.writeHead(response.statusCode || 200, response.headers)\n              )\n              .on(`error`, (err, _, response) => {\n                if (response) {\n                  res.writeHead(response.statusCode || 400, response.headers)\n                } else {\n                  const message = `Error when trying to proxy request \"${req.originalUrl}\" to \"${proxiedUrl}\"`\n\n                  report.error(message, err)\n                  res.sendStatus(500)\n                }\n              })\n          )\n          .pipe(res)\n      })\n    })\n  }\n\n  await apiRunnerNode(`onCreateDevServer`, { app })\n\n  // In case nothing before handled hot-update - send 404.\n  // This fixes \"Unexpected token < in JSON at position 0\" runtime\n  // errors after restarting development server and\n  // cause automatic hard refresh in the browser.\n  app.use(/.*\\.hot-update\\.json$/i, (_, res) => {\n    res.status(404).end()\n  })\n\n  // Render an HTML page and serve it.\n  app.use((_, res) => {\n    res.sendFile(directoryPath(`public/index.html`), err => {\n      if (err) {\n        res.status(500).end()\n      }\n    })\n  })\n\n  /**\n   * Set up the HTTP server and socket.io.\n   * If a SSL cert exists in program, use it with `createServer`.\n   **/\n  const server = program.ssl\n    ? https.createServer(program.ssl, app)\n    : new http.Server(app)\n\n  const socket = websocketManager.init({ server, directory: program.directory })\n\n  const listener = server.listen(program.port, program.host)\n\n  // Register watcher that rebuilds index.html every time html.js changes.\n  const watchGlobs = [`src/html.js`, `plugins/**/gatsby-ssr.js`].map(path =>\n    slash(directoryPath(path))\n  )\n\n  chokidar.watch(watchGlobs).on(`change`, async () => {\n    await createIndexHtml(indexHTMLActivity)\n    socket.to(`clients`).emit(`reload`)\n  })\n\n  return { compiler, listener, webpackActivity }\n}\n\nmodule.exports = async (program: IProgram): Promise<void> => {\n  // We want to prompt the feedback request when users quit develop\n  // assuming they pass the heuristic check to know they are a user\n  // we want to request feedback from, and we're not annoying them.\n  process.on(\n    `SIGINT`,\n    async (): Promise<void> => {\n      if (await userPassesFeedbackRequestHeuristic()) {\n        showFeedbackRequest()\n      }\n      process.exit(0)\n    }\n  )\n\n  if (process.env.GATSBY_EXPERIMENTAL_PAGE_BUILD_ON_DATA_CHANGES) {\n    report.panic(\n      `The flag ${chalk.yellow(\n        `GATSBY_EXPERIMENTAL_PAGE_BUILD_ON_DATA_CHANGES`\n      )} is not available with ${chalk.cyan(\n        `gatsby develop`\n      )}, please retry using ${chalk.cyan(`gatsby build`)}`\n    )\n  }\n  initTracer(program.openTracingConfigFile)\n  report.pendingActivity({ id: `webpack-develop` })\n  telemetry.trackCli(`DEVELOP_START`)\n  telemetry.startBackgroundUpdate()\n\n  const port =\n    typeof program.port === `string` ? parseInt(program.port, 10) : program.port\n\n  // In order to enable custom ssl, --cert-file --key-file and -https flags must all be\n  // used together\n  if ((program[`cert-file`] || program[`key-file`]) && !program.https) {\n    report.panic(\n      `for custom ssl --https, --cert-file, and --key-file must be used together`\n    )\n  }\n\n  try {\n    program.port = await detectPortInUseAndPrompt(port)\n  } catch (e) {\n    if (e.message === `USER_REJECTED`) {\n      process.exit(0)\n    }\n\n    throw e\n  }\n\n  // Check if https is enabled, then create or get SSL cert.\n  // Certs are named 'devcert' and issued to the host.\n  if (program.https) {\n    const sslHost =\n      program.host === `0.0.0.0` || program.host === `::`\n        ? `localhost`\n        : program.host\n\n    if (REGEX_IP.test(sslHost)) {\n      report.panic(\n        `You're trying to generate a ssl certificate for an IP (${sslHost}). Please use a hostname instead.`\n      )\n    }\n\n    program.ssl = await getSslCert({\n      name: sslHost,\n      certFile: program[`cert-file`],\n      keyFile: program[`key-file`],\n      directory: program.directory,\n    })\n  }\n\n  // Start bootstrap process.\n  const { graphqlRunner } = await bootstrap(program)\n\n  // Start the createPages hot reloader.\n  bootstrapPageHotReloader(graphqlRunner)\n\n  // Start the schema hot reloader.\n  bootstrapSchemaHotReloader()\n\n  await queryUtil.initialProcessQueries()\n\n  require(`../redux/actions`).boundActionCreators.setProgramStatus(\n    `BOOTSTRAP_QUERY_RUNNING_FINISHED`\n  )\n  await db.saveState()\n\n  await waitUntilAllJobsComplete()\n  requiresWriter.startListener()\n  db.startAutosave()\n  queryUtil.startListeningToDevelopQueue()\n  queryWatcher.startWatchDeletePage()\n\n  let { compiler, webpackActivity } = await startServer(program)\n\n  interface IPreparedUrls {\n    lanUrlForConfig: string\n    lanUrlForTerminal: string\n    localUrlForTerminal: string\n    localUrlForBrowser: string\n  }\n\n  function prepareUrls(\n    protocol: `http` | `https`,\n    host: string,\n    port: number\n  ): IPreparedUrls {\n    const formatUrl = (hostname: string): string =>\n      url.format({\n        protocol,\n        hostname,\n        port,\n        pathname: `/`,\n      })\n    const prettyPrintUrl = (hostname: string): string =>\n      url.format({\n        protocol,\n        hostname,\n        port: chalk.bold(String(port)),\n        pathname: `/`,\n      })\n\n    const isUnspecifiedHost = host === `0.0.0.0` || host === `::`\n    let prettyHost = host\n    let lanUrlForConfig\n    let lanUrlForTerminal\n    if (isUnspecifiedHost) {\n      prettyHost = `localhost`\n\n      try {\n        // This can only return an IPv4 address\n        lanUrlForConfig = address.ip()\n        if (lanUrlForConfig) {\n          // Check if the address is a private ip\n          // https://en.wikipedia.org/wiki/Private_network#Private_IPv4_address_spaces\n          if (\n            /^10[.]|^172[.](1[6-9]|2[0-9]|3[0-1])[.]|^192[.]168[.]/.test(\n              lanUrlForConfig\n            )\n          ) {\n            // Address is private, format it for later use\n            lanUrlForTerminal = prettyPrintUrl(lanUrlForConfig)\n          } else {\n            // Address is not private, so we will discard it\n            lanUrlForConfig = undefined\n          }\n        }\n      } catch (_e) {\n        // ignored\n      }\n    }\n    // TODO collect errors (GraphQL + Webpack) in Redux so we\n    // can clear terminal and print them out on every compile.\n    // Borrow pretty printing code from webpack plugin.\n    const localUrlForTerminal = prettyPrintUrl(prettyHost)\n    const localUrlForBrowser = formatUrl(prettyHost)\n    return {\n      lanUrlForConfig,\n      lanUrlForTerminal,\n      localUrlForTerminal,\n      localUrlForBrowser,\n    }\n  }\n\n  function printInstructions(appName: string, urls: IPreparedUrls): void {\n    console.log()\n    console.log(`You can now view ${chalk.bold(appName)} in the browser.`)\n    console.log()\n\n    if (urls.lanUrlForTerminal) {\n      console.log(\n        `  ${chalk.bold(`Local:`)}            ${urls.localUrlForTerminal}`\n      )\n      console.log(\n        `  ${chalk.bold(`On Your Network:`)}  ${urls.lanUrlForTerminal}`\n      )\n    } else {\n      console.log(`  ${urls.localUrlForTerminal}`)\n    }\n\n    console.log()\n    console.log(\n      `View ${\n        process.env.GATSBY_GRAPHQL_IDE === `playground`\n          ? `the GraphQL Playground`\n          : `GraphiQL`\n      }, an in-browser IDE, to explore your site's data and schema`\n    )\n    console.log()\n\n    if (urls.lanUrlForTerminal) {\n      console.log(\n        `  ${chalk.bold(`Local:`)}            ${\n          urls.localUrlForTerminal\n        }___graphql`\n      )\n      console.log(\n        `  ${chalk.bold(`On Your Network:`)}  ${\n          urls.lanUrlForTerminal\n        }___graphql`\n      )\n    } else {\n      console.log(`  ${urls.localUrlForTerminal}___graphql`)\n    }\n\n    console.log()\n    console.log(`Note that the development build is not optimized.`)\n    console.log(\n      `To create a production build, use ` + `${chalk.cyan(`gatsby build`)}`\n    )\n    console.log()\n  }\n\n  function printDeprecationWarnings(): void {\n    type DeprecatedAPIList = [\"boundActionCreators\", \"pathContext\"] // eslint-disable-line\n    const deprecatedApis: DeprecatedAPIList = [\n      `boundActionCreators`,\n      `pathContext`,\n    ]\n    const fixMap = {\n      boundActionCreators: {\n        newName: `actions`,\n        docsLink: `https://gatsby.dev/boundActionCreators`,\n      },\n      pathContext: {\n        newName: `pageContext`,\n        docsLink: `https://gatsby.dev/pathContext`,\n      },\n    }\n    const deprecatedLocations = {\n      boundActionCreators: [] as string[],\n      pathContext: [] as string[],\n    }\n\n    glob\n      .sync(`{,!(node_modules|public)/**/}*.js`, { nodir: true })\n      .forEach(file => {\n        const fileText = fs.readFileSync(file)\n        const matchingApis = deprecatedApis.filter(api =>\n          fileText.includes(api)\n        )\n        matchingApis.forEach(api => deprecatedLocations[api].push(file))\n      })\n\n    deprecatedApis.forEach(api => {\n      if (deprecatedLocations[api].length) {\n        console.log(\n          `%s %s %s %s`,\n          chalk.cyan(api),\n          chalk.yellow(`is deprecated. Please use`),\n          chalk.cyan(fixMap[api].newName),\n          chalk.yellow(\n            `instead. For migration instructions, see ${fixMap[api].docsLink}\\nCheck the following files:`\n          )\n        )\n        console.log()\n        deprecatedLocations[api].forEach(file => console.log(file))\n        console.log()\n      }\n    })\n  }\n\n  // compiler.hooks.invalid.tap(`log compiling`, function(...args) {\n  //   console.log(`set invalid`, args, this)\n  // })\n\n  compiler.hooks.watchRun.tapAsync(`log compiling`, function(_, done) {\n    if (webpackActivity) {\n      webpackActivity.end()\n    }\n    webpackActivity = report.activityTimer(`Re-building development bundle`, {\n      id: `webpack-develop`,\n    })\n    webpackActivity.start()\n\n    done()\n  })\n\n  let isFirstCompile = true\n  // \"done\" event fires when Webpack has finished recompiling the bundle.\n  // Whether or not you have warnings or errors, you will get this event.\n  compiler.hooks.done.tapAsync(`print gatsby instructions`, function(\n    stats,\n    done\n  ) {\n    // We have switched off the default Webpack output in WebpackDevServer\n    // options so we are going to \"massage\" the warnings and errors and present\n    // them in a readable focused way.\n    const messages = formatWebpackMessages(stats.toJson({}, true))\n    const urls = prepareUrls(\n      program.ssl ? `https` : `http`,\n      program.host,\n      program.port\n    )\n    const isSuccessful = !messages.errors.length\n\n    if (isSuccessful && isFirstCompile) {\n      printInstructions(\n        program.sitePackageJson.name || `(Unnamed package)`,\n        urls\n      )\n      printDeprecationWarnings()\n      if (program.open) {\n        Promise.resolve(openurl(urls.localUrlForBrowser)).catch(() =>\n          console.log(\n            `${chalk.yellow(\n              `warn`\n            )} Browser not opened because no browser was found`\n          )\n        )\n      }\n    }\n\n    isFirstCompile = false\n\n    if (webpackActivity) {\n      reportWebpackWarnings(stats)\n\n      if (!isSuccessful) {\n        const errors = structureWebpackErrors(\n          `develop`,\n          stats.compilation.errors\n        )\n        webpackActivity.panicOnBuild(errors)\n      }\n      webpackActivity.end()\n      webpackActivity = null\n    }\n\n    done()\n  })\n}\n"],"file":"develop.js"}